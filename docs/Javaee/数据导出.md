# 数据导出

## 指定sql，导出数据为 CSV 格式
示例：
```java
package example.utils;

import javax.servlet.http.HttpServletResponse;
import java.io.IOException;
import java.io.PrintWriter;
import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;

public class DataExportUtil {

    /**
     * 导出数据为 CSV 格式
     *
     * @param response HttpServletResponse，用于输出 CSV 文件
     * @param sql      要导出的 SQL 查询语句
     */
    public static void exportToCsv(HttpServletResponse response, String sql) {
        // 设置响应头
        response.setContentType("text/csv;charset=UTF-8");
        response.setCharacterEncoding("UTF-8");
        response.setHeader("Content-Disposition", "attachment;filename=data_export.csv");

        try (PrintWriter writer = response.getWriter();
             Connection conn = DBUtil.getConnection();
             PreparedStatement ps = conn.prepareStatement(sql);
             ResultSet rs = ps.executeQuery()) {

            // 添加 BOM 头，解决 Excel 显示乱码问题
            writer.write('\uFEFF');

            // 写入表头（列名）
            int columnCount = rs.getMetaData().getColumnCount();
            for (int i = 1; i <= columnCount; i++) {
                writer.print(rs.getMetaData().getColumnName(i));
                if (i < columnCount) {
                    writer.print(",");
                }
            }
            writer.println();

            // 写入数据
            while (rs.next()) {
                for (int i = 1; i <= columnCount; i++) {
                    writer.print(rs.getString(i) != null ? rs.getString(i) : ""); // 处理空值
                    if (i < columnCount) {
                        writer.print(",");
                    }
                }
                writer.println();
            }
        } catch (SQLException  | IOException e) {
            e.printStackTrace();
        }
    }
}
```

