# Swing 图片上传操作


## 上传

| 功能                       | 实现情况        |
| -------------------------- | --------------- |
| 支持本地文件选择           | ✅               |
| 自动复制到 `/upload`       | ✅               |
| 自动创建 upload 目录       | ✅               |
| 命名统一、避免重复         | ✅（时间戳命名） |
| 显示上传后图片             | ✅               |
| 输出最终图片路径（可存库） | ✅               |

![image-20250723141502570](http://cdn.qiniu.liyansheng.top/img/image-20250723141502570.png)

```java
package com.bbs.view;

import com.bbs.dao.BookDao;

import javax.swing.*;
import java.awt.*;
import java.io.*;
import java.nio.file.*;
import java.text.SimpleDateFormat;
import java.util.Date;

public class ImageUpload extends JFrame {
    private JLabel imageLabel;
    private JButton selectButton, uploadButton, resetButton,backButton;
    private File selectedImageFile;
    private String uploadedImagePath;


    public ImageUpload(Integer id) throws Exception {
        super("图片上传");
        this.bookId = id;

        selectButton = new JButton("选择图片");
        uploadButton = new JButton("上传图片");
        resetButton = new JButton("重置图片");
        JButton backButton = new JButton("返回"); // ✅ 新增返回按钮

        imageLabel = new JLabel("暂无图片", SwingConstants.CENTER);
        imageLabel.setPreferredSize(new Dimension(200, 200));
        imageLabel.setBorder(BorderFactory.createLineBorder(Color.GRAY));
        imageLabel.setFont(new Font("微软雅黑", Font.PLAIN, 14));
        imageLabel.setForeground(Color.GRAY);

        // 整体使用 BorderLayout
        setLayout(new BorderLayout());

        // 中部内容：按钮 + 图片
        JPanel centerPanel = new JPanel();
        centerPanel.setLayout(new BoxLayout(centerPanel, BoxLayout.Y_AXIS));

        // 原按钮行
        JPanel buttonPanel = new JPanel(new FlowLayout(FlowLayout.CENTER, 15, 10));
        buttonPanel.add(selectButton);
        buttonPanel.add(uploadButton);
        buttonPanel.add(resetButton);

        // 图片显示区域
        JPanel imagePanel = new JPanel();
        imagePanel.add(imageLabel);

        centerPanel.add(buttonPanel);
        centerPanel.add(imagePanel);

        add(centerPanel, BorderLayout.CENTER);

        // 底部返回按钮单独一行
        JPanel bottomPanel = new JPanel();
        bottomPanel.add(backButton);
        add(bottomPanel, BorderLayout.SOUTH);

        // 事件绑定
        selectButton.addActionListener(e -> chooseImageFile());
        uploadButton.addActionListener(e -> confirmUpload());
        resetButton.addActionListener(e -> resetImage());
        backButton.addActionListener(e -> dispose());  // 关闭窗口

        setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
        setSize(450, 360);
        setLocationRelativeTo(null);
        setVisible(true);
    }



    private void chooseImageFile() {
        JFileChooser fileChooser = new JFileChooser();
        fileChooser.setFileFilter(new javax.swing.filechooser.FileFilter() {
            final String[] extensions = { "jpg", "jpeg", "png", "gif", "bmp" };
            @Override
            public boolean accept(File f) {
                if (f.isDirectory()) return true;
                String name = f.getName().toLowerCase();
                for (String ext : extensions) {
                    if (name.endsWith(ext)) return true;
                }
                return false;
            }
            @Override
            public String getDescription() {
                return "图片文件 (*.jpg, *.png, *.gif, *.bmp)";
            }
        });

        int result = fileChooser.showOpenDialog(this);
        if (result == JFileChooser.APPROVE_OPTION) {
            selectedImageFile = fileChooser.getSelectedFile();
            previewImage(selectedImageFile);
        }
    }

    private void resetImage() {
        selectedImageFile = null;
        uploadedImagePath = null;
        imageLabel.setIcon(null);
        imageLabel.setText("暂无图片");
        imageLabel.setForeground(Color.GRAY);
    }

    private void previewImage(File file) {
        if (file == null || !file.exists()) return;
        ImageIcon icon = new ImageIcon(file.getAbsolutePath());
        Image img = icon.getImage().getScaledInstance(
                imageLabel.getWidth(), imageLabel.getHeight(), Image.SCALE_SMOOTH);
        imageLabel.setIcon(new ImageIcon(img));
        imageLabel.setText(null);
    }

    private void confirmUpload() {
        if (selectedImageFile == null) {
            JOptionPane.showMessageDialog(this, "请先选择图片！");
            return;
        }

        String path = saveToUploadDirectory(selectedImageFile);
        if (path != null) {
            uploadedImagePath = path;
            JOptionPane.showMessageDialog(this, "图片上传成功！\n路径：" + uploadedImagePath);
            System.out.println("图片已上传至：" + uploadedImagePath);
            // TODO: 保存路径
            dispose();
        } else {
            JOptionPane.showMessageDialog(this, "图片上传失败！");
        }
    }

    private String saveToUploadDirectory(File sourceFile) {
        try {
            File uploadDir = new File("upload");
            if (!uploadDir.exists()) uploadDir.mkdirs();

            String originalName = sourceFile.getName();
            String ext = originalName.substring(originalName.lastIndexOf("."));
            String timeStr = new SimpleDateFormat("yyyyMMddHHmmss").format(new Date());
            String newFileName = "dish_" + timeStr + ext;

            File destFile = new File(uploadDir, newFileName);
            Files.copy(sourceFile.toPath(), destFile.toPath(), StandardCopyOption.REPLACE_EXISTING);
            return destFile.getAbsolutePath();
        } catch (IOException e) {
            e.printStackTrace();
        }
        return null;
    }
}


```

## 图片展示

- 图片自适应
- 表格可指定显示图片的列，可设置表格字体、表头字体大小
- 表格可指定隐藏某些行
- 方便复用

![image-20250723131118279](http://cdn.qiniu.liyansheng.top/img/image-20250723131118279.png)

```java
package com.bbs.util;

import javax.swing.*;
import javax.swing.table.DefaultTableCellRenderer;
import javax.swing.table.DefaultTableModel;
import javax.swing.table.TableCellRenderer;
import java.awt.*;
import java.io.File;
import java.net.URL;
import java.util.Set;

public class PlusTable extends JTable {

    public PlusTable(Object[][] data, String[] columnNames, Set<Integer> imageColumns, Set<Integer> hiddenColumns) {
        super(new DefaultTableModel(data, columnNames) {
            @Override
            public boolean isCellEditable(int row, int column) {
                return false;
            }

            @Override
            public Class<?> getColumnClass(int columnIndex) {
                return String.class;
            }
        });

        //        getTableHeader().setFont(new Font("宋体", Font.BOLD, 18)); // 设置表头字体

//        setFont(new Font("宋体", Font.PLAIN, 18));  // 设置表格字体

        setRowHeight(100); // 设置行高

        // 图片列渲染器
        for (int col : imageColumns) {
            getColumnModel().getColumn(col).setCellRenderer(new ProportionalImageRenderer());
        }

        // 非图片列居中
        DefaultTableCellRenderer centerRenderer = new DefaultTableCellRenderer();
        centerRenderer.setHorizontalAlignment(SwingConstants.CENTER);
        for (int i = 0; i < getColumnCount(); i++) {
            if (!imageColumns.contains(i)) {
                getColumnModel().getColumn(i).setCellRenderer(centerRenderer);
            }
        }

        // 隐藏指定列
        if (hiddenColumns != null) {
            for (int i = getColumnCount() - 1; i >= 0; i--) { // 从后向前删，避免越界
                if (hiddenColumns.contains(i)) {
                    getColumnModel().removeColumn(getColumnModel().getColumn(i));
                }
            }
        }
    }

    // 图片渲染器内部类
    static class ProportionalImageRenderer extends JLabel implements TableCellRenderer {
        private static final int VERTICAL_PADDING = 5;

        public ProportionalImageRenderer() {
            setHorizontalAlignment(CENTER);
            setVerticalAlignment(CENTER);
            setOpaque(true);
            setBorder(BorderFactory.createEmptyBorder(VERTICAL_PADDING, 0, VERTICAL_PADDING, 0));
        }

        @Override
        public Component getTableCellRendererComponent(JTable table, Object value,
                                                       boolean isSelected, boolean hasFocus,
                                                       int row, int column) {
            setText(null);
            setIcon(null);

            if (value instanceof String) {
                String path = (String) value;
                try {
                    ImageIcon icon;
                    if (path.startsWith("http://") || path.startsWith("https://")) {
                        icon = new ImageIcon(new URL(path));
                    } else {
                        File imgFile = new File(path);
                        if (!imgFile.exists()) {
                            setText("图片不存在");
                            return this;
                        }
                        icon = new ImageIcon(path);
                    }

                    int cellWidth = table.getColumnModel().getColumn(column).getWidth();
                    int cellHeight = table.getRowHeight(row) - 2 * VERTICAL_PADDING;

                    int imgWidth = icon.getIconWidth();
                    int imgHeight = icon.getIconHeight();

                    if (imgWidth > 0 && imgHeight > 0) {
                        double widthRatio = (double) cellWidth / imgWidth;
                        double heightRatio = (double) cellHeight / imgHeight;
                        double scale = Math.min(widthRatio, heightRatio);

                        int newWidth = (int) (imgWidth * scale);
                        int newHeight = (int) (imgHeight * scale);

                        Image scaledImg = icon.getImage().getScaledInstance(newWidth, newHeight, Image.SCALE_SMOOTH);
                        setIcon(new ImageIcon(scaledImg));
                    }
                } catch (Exception ex) {
                    setText("加载失败");
                }
            }

            return this;
        }
    }
}

```

## 如何使用

```java
private JTable table;

table = new PlusTable(new Object[][]{}, columnNames, Set.of(5),Set.of());
table.setRowHeight(100);
scrollPane.setViewportView(table);
initTable();

    private void fillTable(List<Book> bookList) {
        DefaultTableModel model = (DefaultTableModel) table.getModel();
        model.setRowCount(0); // 清除旧数据
        for (Book book : bookList) {
            model.addRow(new Object[]{
                    book.getId(),
                    book.getTitle(),
                    book.getAuthor(),
                    book.getIsbn(),
                    book.getCount(),
                    book.getCover()
            });
        }
    }
```