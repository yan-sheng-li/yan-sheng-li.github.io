# Swing 图片上传操作

## 上传

| 功能                       | 实现情况        |
| -------------------------- | --------------- |
| 支持本地文件选择           | ✅               |
| 自动复制到 `/upload`       | ✅               |
| 自动创建 upload 目录       | ✅               |
| 命名统一、避免重复         | ✅（时间戳命名） |
| 显示上传后图片             | ✅               |
| 输出最终图片路径（可存库） | ✅               |

![image-20250723141502570](http://cdn.qiniu.liyansheng.top/img/image-20250723141502570.png)

```java
import javax.swing.*;
import java.awt.*;
import java.io.*;
import java.nio.file.*;
import java.text.SimpleDateFormat;
import java.util.Date;

public class ImageUploadDemo extends JFrame {
    private JLabel imageLabel;
    private JButton selectButton, uploadButton, resetButton;
    private File selectedImageFile;
    private String uploadedImagePath;

    public ImageUploadDemo() {
        super("图片上传示范");

        selectButton = new JButton("选择图片");
        uploadButton = new JButton("上传图片");
        resetButton = new JButton("重置图片");

        imageLabel = new JLabel("暂无图片", SwingConstants.CENTER);
        imageLabel.setPreferredSize(new Dimension(200, 200));
        imageLabel.setBorder(BorderFactory.createLineBorder(Color.GRAY));
        imageLabel.setFont(new Font("微软雅黑", Font.PLAIN, 14));
        imageLabel.setForeground(Color.GRAY);

        setLayout(new FlowLayout());
        add(selectButton);
        add(uploadButton);
        add(resetButton);
        add(imageLabel);

        selectButton.addActionListener(e -> chooseImageFile());
        uploadButton.addActionListener(e -> confirmUpload());
        resetButton.addActionListener(e -> resetImage());

        setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
        setSize(420, 330);
        setLocationRelativeTo(null);
        setVisible(true);
    }

    private void chooseImageFile() {
        JFileChooser fileChooser = new JFileChooser();
        fileChooser.setFileFilter(new javax.swing.filechooser.FileFilter() {
            final String[] extensions = { "jpg", "jpeg", "png", "gif", "bmp" };
            @Override
            public boolean accept(File f) {
                if (f.isDirectory()) return true;
                String name = f.getName().toLowerCase();
                for (String ext : extensions) {
                    if (name.endsWith(ext)) return true;
                }
                return false;
            }
            @Override
            public String getDescription() {
                return "图片文件 (*.jpg, *.png, *.gif, *.bmp)";
            }
        });

        int result = fileChooser.showOpenDialog(this);
        if (result == JFileChooser.APPROVE_OPTION) {
            selectedImageFile = fileChooser.getSelectedFile();
            previewImage(selectedImageFile);
        }
    }

    private void resetImage() {
        selectedImageFile = null;
        uploadedImagePath = null;
        imageLabel.setIcon(null);
        imageLabel.setText("暂无图片");
        imageLabel.setForeground(Color.GRAY);
    }

    private void previewImage(File file) {
        if (file == null || !file.exists()) return;
        ImageIcon icon = new ImageIcon(file.getAbsolutePath());
        Image img = icon.getImage().getScaledInstance(
                imageLabel.getWidth(), imageLabel.getHeight(), Image.SCALE_SMOOTH);
        imageLabel.setIcon(new ImageIcon(img));
        imageLabel.setText(null);
    }

    private void confirmUpload() {
        if (selectedImageFile == null) {
            JOptionPane.showMessageDialog(this, "请先选择图片！");
            return;
        }

        String path = saveToUploadDirectory(selectedImageFile);
        if (path != null) {
            uploadedImagePath = path;
            JOptionPane.showMessageDialog(this, "图片上传成功！\n路径：" + uploadedImagePath);
            System.out.println("图片已上传至：" + uploadedImagePath);
        } else {
            JOptionPane.showMessageDialog(this, "图片上传失败！");
        }
    }

    private String saveToUploadDirectory(File sourceFile) {
        try {
            File uploadDir = new File("upload");
            if (!uploadDir.exists()) uploadDir.mkdirs();

            String originalName = sourceFile.getName();
            String ext = originalName.substring(originalName.lastIndexOf("."));
            String timeStr = new SimpleDateFormat("yyyyMMddHHmmss").format(new Date());
            String newFileName = "dish_" + timeStr + ext;

            File destFile = new File(uploadDir, newFileName);
            Files.copy(sourceFile.toPath(), destFile.toPath(), StandardCopyOption.REPLACE_EXISTING);
            return destFile.getAbsolutePath();
        } catch (IOException e) {
            e.printStackTrace();
        }
        return null;
    }

    public static void main(String[] args) {
        SwingUtilities.invokeLater(ImageUploadDemo::new);
    }
}

```

## 图片展示

- 图片自适应
- 表格可指定显示图片的列，可设置表格字体、表头字体大小
- 方便复用

![image-20250723131118279](http://cdn.qiniu.liyansheng.top/img/image-20250723131118279.png)

```java
import javax.swing.*;
import javax.swing.table.DefaultTableCellRenderer;
import javax.swing.table.DefaultTableModel;
import javax.swing.table.TableCellRenderer;
import java.awt.*;
import java.io.File;
import java.net.URL;
import java.util.Set;

public class ImageTableDemo extends JFrame {

    public ImageTableDemo() {
        super("封装版表格显示图片");

        Object[][] data = {
                {"图1", "d/demo2.png", 28.0},
                {"图2", "http://cdn.qiniu.liyansheng.top/img/graphic-4005286_640.png", 22.0}
        };
        String[] columnNames = {"名称", "图片", "价格"};

        // 创建封装后的 ImageTable
        ImageTable table = new ImageTable(data, columnNames, Set.of(1)); // 指定第1列是图片列
        table.setRowHeight(100);

        add(new JScrollPane(table));

        setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
        setSize(600, 300);
        setLocationRelativeTo(null);
        setVisible(true);
    }

    public static void main(String[] args) {
        SwingUtilities.invokeLater(ImageTableDemo::new);
    }
}

// ✅ 可复用的图片表格组件
class ImageTable extends JTable {
    public ImageTable(Object[][] data, String[] columnNames, Set<Integer> imageColumns) {
        super(new DefaultTableModel(data, columnNames) {
            @Override
            public boolean isCellEditable(int row, int column) {
                return false;
            }

            @Override
            public Class<?> getColumnClass(int columnIndex) {
                return String.class;
            }
        });

//        getTableHeader().setFont(new Font("宋体", Font.BOLD, 18)); // 设置表头字体

//        setFont(new Font("宋体", Font.PLAIN, 18));  // 设置表格字体
        setRowHeight(100); // 注意：字体大了要保证行高足够

        // 设置图片列的渲染器
        for (int col : imageColumns) {
            getColumnModel().getColumn(col).setCellRenderer(new ProportionalImageRenderer());
        }
        // 设置非图片列为居中显示
        DefaultTableCellRenderer centerRenderer = new DefaultTableCellRenderer();
        centerRenderer.setHorizontalAlignment(SwingConstants.CENTER);

        for (int i = 0; i < getColumnCount(); i++) {
            if (!imageColumns.contains(i)) {
                getColumnModel().getColumn(i).setCellRenderer(centerRenderer);
            }
        }
    }

    // 图片渲染器（内部类或外部类都可以）
    static class ProportionalImageRenderer extends JLabel implements TableCellRenderer {
        public ProportionalImageRenderer() {
            setHorizontalAlignment(CENTER);
            setVerticalAlignment(CENTER);
            setOpaque(true);
        }

        @Override
        public Component getTableCellRendererComponent(JTable table, Object value,
                                                       boolean isSelected, boolean hasFocus,
                                                       int row, int column) {
            setText(null);
            setIcon(null);

            if (value instanceof String) {
                String path = (String) value;

                try {
                    ImageIcon icon;
                    if (path.startsWith("http://") || path.startsWith("https://")) {
                        icon = new ImageIcon(new URL(path));
                    } else {
                        File imgFile = new File(path);
                        if (!imgFile.exists()) {
                            setText("图片不存在");
                            return this;
                        }
                        icon = new ImageIcon(path);
                    }

                    int cellWidth = table.getColumnModel().getColumn(column).getWidth();
                    int cellHeight = table.getRowHeight(row);

                    int imgWidth = icon.getIconWidth();
                    int imgHeight = icon.getIconHeight();

                    if (imgWidth > 0 && imgHeight > 0) {
                        double widthRatio = (double) cellWidth / imgWidth;
                        double heightRatio = (double) cellHeight / imgHeight;
                        double scale = Math.min(widthRatio, heightRatio);

                        int newWidth = (int) (imgWidth * scale);
                        int newHeight = (int) (imgHeight * scale);

                        Image scaledImg = icon.getImage().getScaledInstance(newWidth, newHeight, Image.SCALE_SMOOTH);
                        setIcon(new ImageIcon(scaledImg));
                    }

                } catch (Exception ex) {
                    setText("加载失败");
                }
            }

            return this;
        }
    }
}
```