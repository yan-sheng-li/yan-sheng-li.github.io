(window.webpackJsonp=window.webpackJsonp||[]).push([[366],{754:function(a,t,s){"use strict";s.r(t);var e=s(1),r=Object(e.a)({},(function(){var a=this,t=a._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h1",{attrs:{id:"自制hls视频流"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#自制hls视频流"}},[a._v("#")]),a._v(" 自制HLS视频流")]),a._v(" "),t("p",[t("img",{attrs:{src:"http://cdn.qiniu.liyansheng.top/img/image-20250208231619262.png",alt:"image-20250208231619262"}})]),a._v(" "),t("h2",{attrs:{id:"环境"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#环境"}},[a._v("#")]),a._v(" 环境")]),a._v(" "),t("ul",[t("li",[a._v("操作系统：CentOS 7")])]),a._v(" "),t("h2",{attrs:{id:"简介"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#简介"}},[a._v("#")]),a._v(" 简介")]),a._v(" "),t("p",[a._v("FFmpeg 是一个功能强大的开源多媒体处理工具集，包含 libavcodec、libavformat 和 libavutil 等核心库。它支持多种音视频格式的转换、采样率设置、流媒体捕获以及视频尺寸调整等操作。")]),a._v(" "),t("h2",{attrs:{id:"安装步骤"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装步骤"}},[a._v("#")]),a._v(" 安装步骤")]),a._v(" "),t("h3",{attrs:{id:"_1-启用epel仓库"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-启用epel仓库"}},[a._v("#")]),a._v(" 1. 启用EPEL仓库")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" yum "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" epel-release\n")])])]),t("h3",{attrs:{id:"_2-启用rpm-fusion仓库"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-启用rpm-fusion仓库"}},[a._v("#")]),a._v(" 2. 启用RPM Fusion仓库")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" yum localinstall "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--nogpgcheck")]),a._v(" https://download1.rpmfusion.org/free/el/rpmfusion-free-release-7.noarch.rpm\n")])])]),t("h3",{attrs:{id:"_3-安装ffmpeg"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-安装ffmpeg"}},[a._v("#")]),a._v(" 3. 安装FFmpeg")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" yum "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" ffmpeg ffmpeg-devel\n")])])]),t("h3",{attrs:{id:"_4-验证安装"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-验证安装"}},[a._v("#")]),a._v(" 4. 验证安装")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("ffmpeg "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-version")]),a._v("\n")])])]),t("h2",{attrs:{id:"hls流媒体制作"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#hls流媒体制作"}},[a._v("#")]),a._v(" HLS流媒体制作")]),a._v(" "),t("h3",{attrs:{id:"示例-将demo-mp4转换为hls格式"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#示例-将demo-mp4转换为hls格式"}},[a._v("#")]),a._v(" 示例：将"),t("code",[a._v("demo.mp4")]),a._v("转换为HLS格式")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("ffmpeg "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-i")]),a._v(" demo.mp4 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n       "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-c:v")]),a._v(" libx264 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n       "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-preset")]),a._v(" ultrafast "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n       "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-crf")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("23")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n       "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-c:a")]),a._v(" aac "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n       "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-b:a")]),a._v(" 128k "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n       "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-map")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),a._v(":v:0 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n       "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-map")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),a._v(":a:0 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n       "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-f")]),a._v(" hls "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n       "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-hls_time")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("4")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n       "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-hls_list_size")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n       "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-hls_base_url")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"demo/"')]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n       "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-hls_segment_filename")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"demo/demo_%03d.ts"')]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n       demo.m3u8\n")])])]),t("h3",{attrs:{id:"参数说明"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#参数说明"}},[a._v("#")]),a._v(" 参数说明")]),a._v(" "),t("table",[t("thead",[t("tr",[t("th",[a._v("参数")]),a._v(" "),t("th",[a._v("说明")])])]),a._v(" "),t("tbody",[t("tr",[t("td",[t("code",[a._v("-i demo.mp4")])]),a._v(" "),t("td",[a._v("指定输入文件")])]),a._v(" "),t("tr",[t("td",[t("code",[a._v("-c:v libx264")])]),a._v(" "),t("td",[a._v("使用H.264编码器")])]),a._v(" "),t("tr",[t("td",[t("code",[a._v("-preset ultrafast")])]),a._v(" "),t("td",[a._v("使用最快的编码预设")])]),a._v(" "),t("tr",[t("td",[t("code",[a._v("-crf 23")])]),a._v(" "),t("td",[a._v("视频质量参数（范围0-51，值越小质量越高）")])]),a._v(" "),t("tr",[t("td",[t("code",[a._v("-c:a aac")])]),a._v(" "),t("td",[a._v("使用AAC音频编码")])]),a._v(" "),t("tr",[t("td",[t("code",[a._v("-b:a 128k")])]),a._v(" "),t("td",[a._v("设置音频比特率为128kbps")])]),a._v(" "),t("tr",[t("td",[t("code",[a._v("-map 0:v:0 -map 0:a:0")])]),a._v(" "),t("td",[a._v("选择第一个视频和音频流")])]),a._v(" "),t("tr",[t("td",[t("code",[a._v("-f hls")])]),a._v(" "),t("td",[a._v("指定输出格式为HLS")])]),a._v(" "),t("tr",[t("td",[t("code",[a._v("-hls_time 4")])]),a._v(" "),t("td",[a._v("设置每个TS切片时长为4秒")])]),a._v(" "),t("tr",[t("td",[t("code",[a._v("-hls_list_size 0")])]),a._v(" "),t("td",[a._v("播放列表包含所有切片")])]),a._v(" "),t("tr",[t("td",[t("code",[a._v('-hls_base_url "demo/"')])]),a._v(" "),t("td",[a._v("设置切片文件的基础路径")])]),a._v(" "),t("tr",[t("td",[t("code",[a._v('-hls_segment_filename "demo/demo_%03d.ts"')])]),a._v(" "),t("td",[a._v("指定切片文件命名格式")])])])]),a._v(" "),t("p",[t("img",{attrs:{src:"http://cdn.qiniu.liyansheng.top/img/image-20250208231245870.png",alt:"image-20250208231245870"}})]),a._v(" "),t("p",[t("img",{attrs:{src:"http://cdn.qiniu.liyansheng.top/img/image-20250208231334176.png",alt:"image-20250208231334176"}})]),a._v(" "),t("h2",{attrs:{id:"nginx服务器配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#nginx服务器配置"}},[a._v("#")]),a._v(" Nginx服务器配置")]),a._v(" "),t("h3",{attrs:{id:"文件存放路径"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#文件存放路径"}},[a._v("#")]),a._v(" 文件存放路径")]),a._v(" "),t("p",[t("code",[a._v("/usr/share/nginx/html/video")])]),a._v(" "),t("h3",{attrs:{id:"nginx配置示例"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#nginx配置示例"}},[a._v("#")]),a._v(" Nginx配置示例")]),a._v(" "),t("div",{staticClass:"language-nginx extra-class"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("server")])]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("listen")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("80")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("server_name")]),a._v(" xxx.com")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n    \n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("location")]),a._v(" /hls/")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("alias")]),a._v(" /usr/share/nginx/html/video/")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("add_header")]),a._v(" Access-Control-Allow-Origin *")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("add_header")]),a._v(" Cache-Control no-cache")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("expires")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("30s")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n        \n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("types")])]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("application/vnd.apple.mpegurl")]),a._v(" m3u8")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("video/mp2t")]),a._v(" ts")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])]),t("h3",{attrs:{id:"配置生效"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置生效"}},[a._v("#")]),a._v(" 配置生效")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" systemctl restart nginx\n")])])]),t("h2",{attrs:{id:"播放链接示例"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#播放链接示例"}},[a._v("#")]),a._v(" 播放链接示例")]),a._v(" "),t("p",[t("code",[a._v("http://xxx.com/hls/demo.m3u8")])]),a._v(" "),t("h2",{attrs:{id:"播放方法"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#播放方法"}},[a._v("#")]),a._v(" 播放方法")]),a._v(" "),t("ol",[t("li",[a._v("打开支持HLS的播放器（如VLC、PotPlayer等）")]),a._v(" "),t("li",[a._v("添加网络流，输入"),t("code",[a._v(".m3u8")]),a._v("链接")]),a._v(" "),t("li",[a._v("开始播放")])]),a._v(" "),t("h2",{attrs:{id:"注意事项"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#注意事项"}},[a._v("#")]),a._v(" 注意事项")]),a._v(" "),t("ul",[t("li",[a._v("确保服务器防火墙开放80端口")]),a._v(" "),t("li",[a._v("视频文件路径和Nginx配置中的路径需保持一致")]),a._v(" "),t("li",[a._v("可根据实际需求调整HLS切片时长和视频质量参数")]),a._v(" "),t("li",[a._v("视频太长，可以将视频切割后再分片，"),t("a",{attrs:{href:"https://www.bandicam.com/bandicut-video-cutter/",target:"_blank",rel:"noopener noreferrer"}},[a._v("切割工具"),t("OutboundLink")],1)])])])}),[],!1,null,null,null);t.default=r.exports}}]);